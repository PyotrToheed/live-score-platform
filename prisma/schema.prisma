generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Language {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  code      String   @unique // e.g., 'en', 'es'
  name      String
  isVisible Boolean  @default(true) // Controls if available in switcher
  isSource  Boolean  @default(false) // Primary data source language
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  leagueTranslations     LeagueTranslation[]
  matchTranslations      MatchTranslation[]
  predictionTranslations PredictionTranslation[]
  articleTranslations    ArticleTranslation[]
  bookmakerTranslations  BookmakerTranslation[]
}

model SiteSettings {
  id             String  @id @default(auto()) @map("_id") @db.ObjectId
  siteName       String  @default("LiveBaz")
  defaultLocale  String  @default("en")
  
  // Global SEO Default Fallbacks
  globalTitle    String? 
  globalDesc     String?
  globalBrandColor String @default("#2563eb")
  
  // Script Injections
  headScripts    String?
  bodyScripts    String?
  
  updatedAt      DateTime @updatedAt
}

model SeoFields {
  id             String  @id @default(auto()) @map("_id") @db.ObjectId
  title          String?
  description    String?
  canonical      String?
  ogTitle        String?
  ogDescription  String?
  ogImage        String?
  noIndex        Boolean @default(false)
  jsonLd         String? // Custom structured data JSON

  // One-to-one relations with other entities (at translation level)
  leagueTranslation     LeagueTranslation?
  matchTranslation      MatchTranslation?
  articleTranslation    ArticleTranslation?
}

model League {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  apiId     String?  @unique // Link to API-Sports ID
  country   String
  logoUrl   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  matches      Match[]
  translations LeagueTranslation[]
}

model LeagueTranslation {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  leagueId    String   @db.ObjectId
  languageCode String
  slug        String   @unique
  name        String
  description String?
  isActive    Boolean  @default(true) // Controls if this specific league/lang is public

  league    League    @relation(fields: [leagueId], references: [id])
  language  Language  @relation(fields: [languageCode], references: [code])
  
  seoId     String    @unique @db.ObjectId
  seo       SeoFields @relation(fields: [seoId], references: [id])

  @@unique([leagueId, languageCode])
}

model Match {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  date        DateTime
  homeTeam    String
  awayTeam    String
  homeScore   Int?
  awayScore   Int?
  leagueId    String   @db.ObjectId
  status      String   @default("SCHEDULED")
  
  minute      Int?    
  apiSportsId String? 
  lineups     String? 
  stats       String? 
  homeTeamLogo String? 
  awayTeamLogo String? 
  
  mainTip       String? 
  confidence    Int?    
  isFeatured    Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  league    League    @relation(fields: [leagueId], references: [id])
  
  prediction   Prediction?
  translations MatchTranslation[]
}

model MatchTranslation {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  matchId     String   @db.ObjectId
  languageCode String
  slug        String   @unique
  name        String 
  content     String? 
  analysis    String? 
  isActive    Boolean  @default(true)

  match     Match     @relation(fields: [matchId], references: [id])
  language  Language  @relation(fields: [languageCode], references: [code])
  
  seoId     String    @unique @db.ObjectId
  seo       SeoFields @relation(fields: [seoId], references: [id])

  @@unique([matchId, languageCode])
}

model Prediction {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  matchId        String   @unique @db.ObjectId
  winProbHome    Float
  winProbAway    Float
  winProbDraw    Float
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  match        Match       @relation(fields: [matchId], references: [id])
  translations PredictionTranslation[]
}

model PredictionTranslation {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  predictionId   String   @db.ObjectId
  languageCode   String
  analysis       String 

  prediction Prediction @relation(fields: [predictionId], references: [id])
  language   Language   @relation(fields: [languageCode], references: [code])

  @@unique([predictionId, languageCode])
}

model Article {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  category      String
  published     Boolean  @default(false)
  featuredImage String?  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  translations ArticleTranslation[]
  tagIds       String[] @db.ObjectId
  tags         Tag[]    @relation(fields: [tagIds], references: [id])
}

model Tag {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String   @unique
  slug        String   @unique
  articleIds  String[] @db.ObjectId
  articles    Article[] @relation(fields: [articleIds], references: [id])
}

model ArticleTranslation {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  articleId   String   @db.ObjectId
  languageCode String
  slug        String   @unique
  title       String
  content     String   
  excerpt     String?
  isActive    Boolean  @default(true)

  article   Article   @relation(fields: [articleId], references: [id])
  language  Language  @relation(fields: [languageCode], references: [code])
  
  seoId     String    @unique @db.ObjectId
  seo       SeoFields @relation(fields: [seoId], references: [id])

  @@unique([articleId, languageCode])
}

model AdminUser {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String   @unique
  password  String
  name      String?
  role      String   @default("ADMIN")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Bookmaker {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  logoUrl     String?  
  rating      Float    @default(5.0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  translations BookmakerTranslation[]
}

model BookmakerTranslation {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  bookmakerId  String   @db.ObjectId
  languageCode String
  name         String
  bonusText    String
  affiliateUrl String

  bookmaker Bookmaker @relation(fields: [bookmakerId], references: [id])
  language  Language  @relation(fields: [languageCode], references: [code])

  @@unique([bookmakerId, languageCode])
}

